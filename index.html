<script>
  function showSection(sectionId) {
    document.querySelectorAll('.content').forEach(sec => sec.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');
    removeHighlights();
  }

  function toggleSearch() {
    const box = document.getElementById("searchBox");
    box.style.display = box.style.display === "block" ? "none" : "block";
    document.getElementById("suggestions").innerHTML = "";
    document.getElementById("searchInput").value = "";
    removeHighlights();
  }

  document.addEventListener("click", function(event) {
    const box = document.getElementById("searchBox");
    const icon = document.querySelector(".search-icon");
    if (!box.contains(event.target) && !icon.contains(event.target)) {
      box.style.display = "none";
    }
  });

  function showSuggestions(query) {
    const suggestionsBox = document.getElementById("suggestions");
    const sections = document.querySelectorAll("section");
    suggestionsBox.innerHTML = "";
    removeHighlights();

    if (query.length < 2) return;

    let results = [];
    sections.forEach(sec => {
      if (sec.innerText.toLowerCase().includes(query.toLowerCase())) {
        // tìm vị trí match đầu tiên
        const idx = sec.innerText.toLowerCase().indexOf(query.toLowerCase());
        const snippet = sec.innerText.substring(idx, idx + query.length + 20);
        results.push({
          id: sec.id,
          keyword: query,
          context: snippet + "..."
        });
      }
    });

    if (results.length === 0) {
      suggestionsBox.innerHTML = "<div>No result found</div>";
    } else {
      results.forEach(r => {
        const div = document.createElement("div");
        div.innerHTML = `<strong>${r.keyword}</strong> - ${r.context}`;
        div.onclick = () => highlightAndShow(r.id, r.keyword);
        suggestionsBox.appendChild(div);
      });
    }
  }

  function highlightAndShow(sectionId, keyword) {
    showSection(sectionId);
    const section = document.getElementById(sectionId);
    highlightText(section, keyword);
    document.getElementById("searchBox").style.display = "none";
  }

  function highlightText(section, keyword) {
    const regex = new RegExp(`(${keyword})`, "gi");
    section.querySelectorAll("*:not(script):not(style)").forEach(node => {
      if (node.childNodes && node.childNodes.length) {
        node.childNodes.forEach(child => {
          if (child.nodeType === 3 && regex.test(child.textContent)) {
            const span = document.createElement("span");
            span.innerHTML = child.textContent.replace(regex, "<mark>$1</mark>");
            node.replaceChild(span, child);
          }
        });
      }
    });
  }

  function removeHighlights() {
    document.querySelectorAll("mark").forEach(el => {
      el.outerHTML = el.innerText;
    });
  }

  document.addEventListener('DOMContentLoaded', () => showSection('home'));
</script>
